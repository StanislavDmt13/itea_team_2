{% extends "base.html" %}

{% load static %}

{% block content %}

<div class="container justify-content-center" style="padding-top:92px">
    <!-- TrainRec header div-->
    <div class="row justify-content-center text-center ">
        <div class="col-3">
            <h3>TrainRec(tm)</h3>
        </div>
    </div>

    <!-- Form -->
    <form id="training_post_form" action="" method="POST">
        <div class="row justify-content-center" style="padding-top:52px">
            <div class="col-10 text-center justify-content-center" style="padding:30">
                <input type="hidden" name="csrfmiddlewaretoken" value="lSTWy0YMSZpnpxE0NpbQqtWzLbLSZJwNBYJNY7pFBMCJt98YLrgd5Vuu9CT3uZEY">
                <input id="datetime_started_ISO" type="hidden" name="datetime_started_ISO" value="">
                <input id="datetime_finished_ISO" type="hidden" name="datetime_finished_ISO" value="">
                <div class="input-group mb-3">
                    <input type="text" name="post_title" maxlength="200" class="form-control" placeholder="Title" required="" id="id_post_title">
                </div> 
                <div class="input-group mb-3">
                    <textarea name="post_text" cols="40" rows="10" class="form-control" placeholder="Post text" id="id_post_text"></textarea>
                </div> 
                <div class="row" style="margin-bottom:20px">
                    <div class="col-6 align-items-center">
                        <input type="text" name="datetime_started" class="form-control date-time-picker-needed" placeholder="Start of activity" required="" id="id_datetime_started">
                    </div>
                    <div class="col-6 align-items-center">
                        <input type="text" name="datetime_finished" class="form-control date-time-picker-needed" placeholder="End of activity (optional)" id="id_datetime_finished">
                    </div>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" style="width:200px; text-align: right" id="basic-addon1">Post is private</span>
                    <select name="post_is_private" placeholder="Confirm password" id="id_post_is_private">
                        <option value="unknown">Unknown</option>
                        <option value="true" selected="">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div> 
                     
                <script>
                    
                </script>
            </div>
        </div>



    

    <div class="row justify-content-center">
        <div class="col-10 text-center justify-content-center">
            <div class="form-check form-check-inline" >
                <input class="form-check-input" type="radio" name="training type" value="running" onclick = "onTrainingTypeRadioClick(this)" checked>
                <label class="form-check-label" for="running">
                    <img src="{% static 'img/template_types/running_post.png' %}" />
                    Running
                </label>
            </div>

            <div class="form-check form-check-inline" >
                <input class="form-check-input" type="radio" id="css" name="training type" value="hiking" onclick = "onTrainingTypeRadioClick(this)">
                <label class="form-check-label" for="hiking">
                    <img src="{% static 'img/template_types/hiking_post.png' %}" />
                    Hiking
                </label>
            </div>

            <div class="form-check form-check-inline" >
                <input class="form-check-input" type="radio" id="css" name="training type" value="swimming" onclick = "onTrainingTypeRadioClick(this)">
                <label class="form-check-label" for="swimming">
                    <img src="{% static 'img/template_types/swimming_post.png' %}" />
                    Swimming
                </label>
            </div>

            <div id="additional_training_info" style="padding-top:40px;">
                <div id="running_additional_info" class="dummy_additional_info">
                    <div class="input-group mb-3">
                        <input type="text" name="total_km_ran" maxlength="200" class="form-control" placeholder="Number of kilometers covered" required="" id="id_total_km_ran">
                    </div> 
                </div>
                <div id="hiking_additiona_info" hidden class="dummy_additional_info">
                    <div class="input-group mb-3">
                        <input type="text" name="total_km_walked" maxlength="200" class="form-control" placeholder="Number of kilometers walked" required="" id="id_total_km_walked">
                    </div> 
                    <div class="input-group mb-3">
                        <input type="text" name="hike_location" maxlength="200" class="form-control" placeholder="Location description" required="" id="id_hike_location">
                    </div> 
                    <div class="input-group mb-3">
                        <input type="text" name="max_elevation" maxlength="200" class="form-control" placeholder="Max elevation of the route" required="" id="id_max_elevation">
                    </div> 
                    

                </div>
                <div id="swimming_additional_info" hidden class="dummy_additional_info">
                    <div class="input-group mb-3">
                        <input type="text" name="total_km_swum" maxlength="200" class="form-control" placeholder="Number of kilometers swum" required="" id="id_total_km_swum">
                    </div> 
                    <div class="input-group mb-3">
                        <input type="text" name="swimming_location" maxlength="200" class="form-control" placeholder="Location description" required="" id="id_swimming_location">
                    </div> 
                </div>
            </div>

            <div style="padding-top:40px;">
                <button id="submit_button" type="button" class="btn btn-primary" name="Submit">Submit</input>
            </div>
        </div>
    </div>
    </form>
    {% csrf_token %}
</div>

<script>
    function change_date_time_fields_to_ISO() {
        d = new Date($("#id_datetime_started").val());
        $('#datetime_started_ISO').val(d.toISOString())

        if($("#id_datetime_finished").val() != "") {
            d = new Date($("#id_datetime_finished").val());
            $('#datetime_finished_ISO').val(d.toISOString())
        }
        

        {% comment %} $(".date-time-picker-needed").each(
            function() {
                
            }
        ); //$(".date-time-picker-needed").each( {% endcomment %}
    }

    {% comment %} $("#submit_button").click(
        change_date_time_fields_to_ISO
    ); //$("#submit_button").click( {% endcomment %}


    $(".date-time-picker-needed").each(
        function() {
            $(this).datetimepicker()
        }
    )



    function onTrainingTypeRadioClick(radio) {
        console.log("radiobutton clicked");
        console.log($(radio).val());

        $(".dummy_additional_info").each(
            function(idx, val) {
                {% comment %} console.log("have element", val.id) {% endcomment %}
                if(val.id.startsWith($(radio).val())) {
                    $(val).hide().removeAttr('hidden').show(1000);
                } else { //                if(val.id.startsWith($(radio).val())) {
                    //$(val).hide(500);
                    if(!$(val).is(":hidden")) {
                        $(val).animate({
                            opacity: "toggle",
                            height: "toggle"
                          }, 500, function() {
                            $(this).hide();
                            $(this).attr("opacity", "100%")
                          });
                    }
                }; //} else { //                if(val.id.startsWith($(radio).val())) {
            }//function(idx, val) {
        );//$(".dummy_additional_info").each(

    };//function onTrainingTypeRadioClick(radio) {


    $("#submit_button").click(
        function(evt) {
            console.log("clicked submit");
            change_date_time_fields_to_ISO();
            console.log($("#datetime_started_ISO").val());
            
            post_type = $("#training_post_form input[type='radio']:checked").val()
            console.log("post_type:", post_type)

            dta = {
                post_type : post_type, 
                post_title : $("#id_post_title").val(),
                post_text : $("#id_post_text").val(),
                datetime_started : $("#datetime_started_ISO").val(),
                datetime_finished : $("#datetime_finished_ISO").val(),
                post_is_private : $("#id_post_is_private").val(),
                //csrfmiddlewaretoken: readCookie('csrftoken'),
                csrfmiddlewaretoken: $('[name="csrfmiddlewaretoken"]').val(),
            }

            if(post_type == "running") {
                dta.total_km_ran = $("#id_total_km_ran").val();
            };//if(post_type == "running") {

            if(post_type == "hiking") {
                dta.total_km_walked = $("#id_total_km_walked").val(),
                dta.hike_location = $("#id_hike_location").val(),
                dta.max_elevation = $("#id_max_elevation").val()
            };//if(post_type == "hiking") {

            if(post_type == "swimming") {
                console.log('adding swimming data')
                dta.total_km_swum = $("#id_total_km_swum").val(),
                dta.swimming_location = $("#id_swimming_location").val()
            }


            console.log("pre ajax dta:", dta)


            $.ajax({
                type: "POST",
                url: "{% url 'create_training_post' %}",
                data : dta,
                datatype: 'json',
                success : function(data) {
                    console.log("Training record call success", data)
                },//success : function(data) {
                error : function(xhr,status,error) {
                    // console.log("AJAX error occurred");
                    let notifier = new AWN() 
                    notifier.alert('Comment post failed.<br>Please login to post comments.');
                }
            });//$.ajax({
            

        }
    );//$("#submit_button").click(
</script>


{% endblock %}